name: Release
run-name: "üöÄ Release ${{ github.ref_name }} ‚Ä¢ build & publish"

on:
  push:
    tags:
      - "*.*.*"   # ex: 1.0.0

jobs:
  build-and-release:
    name: "üì¶ Build & üì§ Publish"
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout
        uses: actions/checkout@v5

      - name: üß± Build zip artifacts (HACS-compatible structure)
        run: |
          set -e
          TAG="${GITHUB_REF_NAME}"  # ex: 1.0.0
          mkdir -p build
          # √ÆmpachetƒÉm CON»öINUTUL din custom_components/engie_ro
          cd custom_components/engie_ro
          zip -r "../../build/engie_ro-${TAG}.zip" . \
            -x "__pycache__/*" -x "*.pyc" -x ".DS_Store"
          cd - >/dev/null
          # asset cu nume fix pentru HACS (c√¢nd filename din hacs.json e constant)
          cp "build/engie_ro-${TAG}.zip" "build/engie_ro.zip"
          sha256sum "build/engie_ro-${TAG}.zip" > "build/engie_ro-${TAG}.zip.sha256"

      - name: üè∑Ô∏è Publish GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            build/engie_ro-${{ github.ref_name }}.zip
            build/engie_ro-${{ github.ref_name }}.zip.sha256
            build/engie_ro.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
