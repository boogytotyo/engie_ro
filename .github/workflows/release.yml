name: release
on:
  push:
    tags:
      - "*.*.*"   # ex: 1.0.0 (fără 'v')

jobs:
  build-and-release:
    name: Build & Publish
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build zip artifacts (HACS-compatible structure)
        run: |
          set -e
          TAG="${GITHUB_REF_NAME}"  # ex: 1.0.0
          mkdir -p build
          # împachetăm CONȚINUTUL din custom_components/engie_ro
          cd custom_components/engie_ro
          zip -r "../../build/engie_ro-${TAG}.zip" . \
            -x "__pycache__/*" -x "*.pyc" -x ".DS_Store"
          cd - >/dev/null
          # asset cu nume fix pentru HACS (dacă hacs.json folosește filename fix)
          cp "build/engie_ro-${TAG}.zip" "build/engie_ro.zip"
          # (opțional) checksum pentru varianta versionată
          sha256sum "build/engie_ro-${TAG}.zip" > "build/engie_ro-${TAG}.zip.sha256"

      - name: Publish GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            build/engie_ro-${{ github.ref_name }}.zip
            build/engie_ro-${{ github.ref_name }}.zip.sha256
            build/engie_ro.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
